!function(a){var b=a.module("net.enzey.autocomplete",["net.enzey.services","ngSanitize"]),c=function(b){if(null!==b&void 0!==b){if(a.isNumber(b)&&!isNaN(b))return!0;if(a.isString(b)&&""!==b.trim())return!0}return!1};escapeRegexSpecialChars=function(b){return a.isString(b)?b.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):""},b.provider("nzAutoCompleteConfig",function(){var b=function(){},c=1,d=250,e=!1,f=!1;this.setPositionHintsFn=function(c){a.isFunction(c)&&(b=c)},this.setMinimumChars=function(a){c=+a},this.setSilentPeriod=function(a){d=+a},this.isSelectionRequired=function(a){e=!!a},this.isNoResultsOnSelect=function(a){f=!!a},this.$get=function(){return{getPositionHintsFn:function(){return b},getMinimumChars:function(){return c},getSilentPeriod:function(){return d},isSelectionRequired:function(){return e},isNoResultsOnSelect:function(){return f}}}});var d="AutoComplete/hintTemplate.html";b.run(function(a){var b="<div nz-auto-complete-hint-text></div>";a.put(d,b)}),b.directive("nzAutoCompleteHintText",function(a){return{restrict:"AE",link:{post:function(b,c,d){var e=b.ngModelCtrl.$viewValue;e=escapeRegexSpecialChars(e);var f=null===b.displayPath?"hint":"hint."+b.displayPath,g=new RegExp("("+e+")","gi"),h=a(f)(b);if(h){var i=h.replace(g,"<mark>$1</mark>");c[0].innerHTML=i}}}}}),b.directive("nzAutoCompleteInclude",function(a,b,c,d){return{restrict:"AE",compile:function(){var e=this.name;return function(f,g,h){var i=a(h[e])(f);c.get(i,{cache:d}).success(function(a){g.replaceWith(b(a)(f))})}}}});var e=function(b,c){b.css("display","block");var d=b.find("div")[0];d.scrollHeight>d.clientHeight?a.element(d).css("overflow-y","scroll"):a.element(d).css("overflow-y",""),b.css("display","")};b.directive("nzAutoComplete",function(b,f,g,h,i){return{scope:{},restrict:"AE",controller:function(a){a.keyPressEvent=function(b){if(null===a.selectedHintIndex||13!==b.keyCode&&9!==b.keyCode){if(40===b.keyCode){if(null!==a.selectedHintIndex&&a.hints.length>1){var c;c=a.selectedHintIndex===a.hints.length-1?0:a.selectedHintIndex+1,a.selectRow(c)}b.preventDefault(),b.stopPropagation()}else if(38===b.keyCode){if(null!==a.selectedHintIndex&&a.hints.length>1){var c;c=0===a.selectedHintIndex?a.hints.length-1:a.selectedHintIndex-1,a.selectRow(c)}b.preventDefault(),b.stopPropagation()}}else a.select(a.selectedHintIndex)}},compile:function(j,k){j.addClass("autoComplete");var l=j[0].querySelector("input");l=l?a.element(l):a.element('<input type="text"></input>'),j.empty(),l.removeAttr("ng-model"),l.removeAttr("data-ng-model");var m=l.clone();l.addClass("textEntry"),m.addClass("hintBox"),m.attr("tabindex","-1"),m.removeAttr("placeholder");var n=k.ngModel;l.attr("ng-model",n);a.element("<div></div>");return j.append(m),j.append(a.element("<iframe></iframe>")),j.append(l),j.append(a.element('<div class="loadingIndicator"></div>')),{pre:function(a,b,e){a.hints=[];var f=c(e.templateUrl)?e.templateUrl:"'"+d+"'",h=g('							<div class="scrollerContainer">								<iframe></iframe>								<div class="scroller" ng-hide="hints.length < 1" ng-if="!hideResults">									<div class="hint"											ng-repeat="hint in hints"											ng-click="select($index)"											ng-mouseover="hoverOver($index)"											ng-class="{selectedHint: $index === selectedHintIndex}">										<div nz-auto-complete-include="'+f+'"></div>									</div>								</div>								<div class="scroller noResults">									<span class="noResults hint">{{noResultsText}}</span>								</div>							</div>						')(a);b.append(h),a.displayPath=null,c(e.displayPath)&&(a.displayPath=e.displayPath),a.noResultsText="No Results",c(e.noResultsText)&&(a.noResultsText=e.noResultsText),a.hoverOver=function(b){a.selectRow(b)}},post:function(d,g,j){var k=a.element(g[0].querySelector(".textEntry")),l=a.element(g[0].querySelector(".hintBox")),m=a.element(g[0].querySelector(".scrollerContainer")),o=k.controller("ngModel");d.ngModelCtrl=o;var p=function(){g.removeClass("loading")},q=b(j.getResultsFn)(d.$parent);if(!q)throw"A function that returns results is required!";var r=h.getPositionHintsFn();if(c(j.positionHintsFn)){var s=b(j.positionHintsFn)(d.$parent);a.isFunction(s)&&(r=s)}var t=+b(j.minChar)(d.$parent);isNaN(t)&&(t=h.getMinimumChars());var u=+b(j.silentPeriod)(d.$parent);isNaN(u)&&(u=h.getSilentPeriod());var v=h.isSelectionRequired();(""===j.selectionRequired||"true"===j.selectionRequired||d.displayPath)&&(v=!0);var w=h.isNoResultsOnSelect();(""===j.noResultsOnSelect||"true"===j.noResultsOnSelect)&&(w=!0),d.hideResults=!1;var x=function(){var a=d.hints[d.selectedHintIndex];return null!==d.displayPath?b(d.displayPath)(a):a};d.selectRow=function(c){if(c!==d.selectedHintIndex&&c>=0&&c<d.hints.length){var e=g[0].querySelector(".scroller");d.selectedHintIndex=c;var h=i.copyComputedStyles(a.element("<div></div>")[0],k[0]);h=a.element(h),h.css("white-space","nowrap"),h.text(a.isString(o.$viewValue)?o.$viewValue:""),h.css("opacity",0),k.parent().append(h);var j=h[0].scrollWidth<=h[0].clientWidth;if(h.remove(),j){var n=x(),p=new RegExp("^"+escapeRegexSpecialChars(o.$viewValue),"i"),q=b(d.displayPath);if(null!==d.displayPath){var q=b(d.displayPath);j=p.test(q(n))}else j=p.test(n)}if(j===!0){var r=a.isString(o.$viewValue)?o.$viewValue:"";l.val(r+n.slice(r.length,n.length))}else l.val("");f(function(){m.css("display","block");var a=e.querySelector(".selectedHint");a&&(a.offsetTop<e.scrollTop?e.scrollTop=a.offsetTop:a.offsetTop+a.clientHeight>e.scrollTop+e.clientHeight&&(e.scrollTop=a.offsetTop+a.clientHeight-e.clientHeight)),m.css("display","")},50,!1)}},d.select=function(a){d.selectedHintIndex=a;var c=d.hints[d.selectedHintIndex];b(n).assign(d.$parent,c),k[0].focus(),d.$emit("AutoCompleteSelect",c),w&&d.$evalAsync(function(){d.hideResults=!0})};var y=function(a){d.hints=a,d.hints||(d.hints=[]),d.hints.length>0?d.selectRow(0):g.addClass("noResults"),r&&f(function(){r(m,k)||e(m,k)},0,!1)},z=function(){var b=q(a.isString(o.$viewValue)?o.$viewValue:"");return b.then(p,p),b.then(y)};0===t&&z(),k[0].addEventListener("input",function(){f(function(){k[0].value!==o.$viewValue?l[0].style.color="rgba(0, 0, 0, 0)":l[0].style.color=""},0,!1)}),o.$parsers.push(function(a){l.val(""),d.hideResults=!1;var e="";if(a){if(v){var f=d.hints[d.selectedHintIndex];if(d.hints&&d.hints.length>0){var g=f;c(d.displayPath)&&(g=b(d.displayPath)(g)),g=escapeRegexSpecialChars(g),new RegExp(g,"gi").test(a)&&(e=f)}}else e=a;o.$setValidity("hasSelection",e?!0:!1)}return B(),e}),o.$formatters.push(function(a){if(f(B,0,!0),l.val(""),a){var c;return c=d.displayPath?b(d.displayPath)(a):a}});var A,B=function(){d.selectedHintIndex=null,d.hints=[],g.removeClass("noResults"),f.cancel(A),d.hideResults||(g.addClass("loading"),0===t||a.isString(o.$viewValue)&&t<=o.$viewValue.length?A=f(function(){z()},u,!0):p())};k.bind("focus",function(){r&&d.hints&&f(function(){r(m,k)},1,!1)}),k.on("keydown",function(a){d.keyPressEvent(a),d.$apply()})}}}}})}(angular);