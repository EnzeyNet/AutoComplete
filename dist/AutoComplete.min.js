!function(a){var b=a.module("net.enzey.autocomplete",["ngSanitize"]),c=function(b){if(null!==b&void 0!==b){if(a.isNumber(b)&&!isNaN(b))return!0;if(a.isString(b)&&""!==b.trim())return!0}return!1},d="AutoComplete/hintTemplate.html";b.run(function(a){var b="<div nz-auto-complete-hint-text></div>";a.put(d,b)}),b.directive("nzAutoCompleteHintText",function(a){return{restrict:"AE",link:{post:function(b,c){var d=b.ngModelCtrl.$viewValue,e=null===b.displayPath?"hint":"hint."+b.displayPath,f=new RegExp("("+d+")","gi"),g=a(e)(b);if(g){var h=g.replace(f,"<mark>$1</mark>");c[0].innerHTML=h}}}}}),b.directive("nzAutoCompleteInclude",function(a,b,c,d){return{restrict:"AE",compile:function(){var e=this.name;return function(f,g,h){var i=a(h[e])(f);c.get(i,{cache:d}).success(function(a){g.replaceWith(b(a)(f))})}}}});var e=function(b){b.css("display","block");var c=b.find("div")[0];c.scrollHeight>c.clientHeight?a.element(c).css("overflow-y","scroll"):a.element(c).css("overflow-y",""),b.css("display","")};b.directive("nzAutoComplete",function(b,f,g){return{scope:{},restrict:"AE",controller:function(a){a.keyPressEvent=function(b){if(null===a.selectedHintIndex||13!==b.keyCode&&9!==b.keyCode){if(40===b.keyCode){if(null!==a.selectedHintIndex&&a.hints.length>1){var c;c=a.selectedHintIndex===a.hints.length-1?0:a.selectedHintIndex+1,a.selectRow(c)}b.preventDefault(),b.stopPropagation()}else if(38===b.keyCode){if(null!==a.selectedHintIndex&&a.hints.length>1){var c;c=0===a.selectedHintIndex?a.hints.length-1:a.selectedHintIndex-1,a.selectRow(c)}b.preventDefault(),b.stopPropagation()}}else a.select(a.selectedHintIndex)}},compile:function(h,i){h.addClass("autoComplete");var j=h[0].querySelector("input");j=a.element(j?j:'<input type="text"></input>'),h.empty(),j.removeAttr("ng-model"),j.removeAttr("data-ng-model");var k=j.clone();j.addClass("textEntry"),k.addClass("hintBox"),k.attr("tabindex","-1"),k.removeAttr("placeholder");var l=i.ngModel;j.attr("ng-model",l);a.element("<div></div>");return h.append(k),h.append(a.element("<iframe></iframe>")),h.append(j),h.append(a.element('<div class="loadingIndicator"></div>')),{pre:function(a,b,e){a.hints=[];var f=c(e.templateUrl)?e.templateUrl:"'"+d+"'",h=g('							<div class="scrollerContainer">								<iframe></iframe>								<div class="scroller" ng-hide="hints.length < 2">									<div class="hint"											ng-repeat="hint in hints"											ng-click="select($index)"											ng-mouseover="hoverOver($index)"											ng-class="{selectedHint: $index === selectedHintIndex}">										<div nz-auto-complete-include="'+f+'"></div>									</div>								</div>								<div class="scroller noResults">									<span class="noResults hint">{{noResultsText}}</span>								</div>							</div>						')(a);b.append(h),a.displayPath=null,c(e.displayPath)&&(a.displayPath=e.displayPath),a.noResultsText="No Results",c(e.noResultsText)&&(a.noResultsText=e.noResultsText),a.hoverOver=function(b){a.selectRow(b)}},post:function(d,g,h){var i=a.element(g[0].querySelector(".textEntry")),j=a.element(g[0].querySelector(".hintBox")),k=a.element(g[0].querySelector(".scrollerContainer")),m=i.controller("ngModel");d.ngModelCtrl=m;var n=function(){};if(c(h.positionHintsFn)){var o=b(h.positionHintsFn)(d.$parent);a.isFunction(o)&&(n=o)}var p=b(h.getResultsFn)(d.$parent);if(!p)throw"A function that returns results is required!";var q=+b(h.minChar)(d.$parent);isNaN(q)&&(q=1),0===q&&p(m.$viewValue).then(w);var r=+b(h.silentPeriod)(d.$parent);isNaN(r)&&(r=250);var s=!1;(""===h.selectionRequired||"true"===h.selectionRequired)&&(s=!0);var t=!1;(""===h.noResultsOnSelect||"true"===h.noResultsOnSelect)&&(t=!0);var u=!1,v=function(){var a=d.hints[d.selectedHintIndex];return null!==d.displayPath?b(d.displayPath)(a):a};d.selectRow=function(a){if(a!==d.selectedHintIndex&&a>=0&&a<d.hints.length){var c=g[0].querySelector(".scroller");d.selectedHintIndex=a;var e=!(i[0].scrollWidth>i[0].clientWidth);if(e){var h=v(),l=new RegExp("^"+m.$viewValue,"i"),n=n=b(d.displayPath);if(null!==d.displayPath){var n=n=b(d.displayPath);e=l.test(n(h))}else e=l.test(h)}if(e===!0){var o=i.val();j.val(o+h.slice(o.length,h.length))}else j.val("");f(function(){k.css("display","block");var a=c.querySelector(".selectedHint");a.offsetTop<c.scrollTop?c.scrollTop=a.offsetTop:a.offsetTop+a.clientHeight>c.scrollTop+c.clientHeight&&(c.scrollTop=a.offsetTop+a.clientHeight-c.clientHeight),k.css("display","")},50,!1)}},d.select=function(a){d.selectedHintIndex=a;var c=d.hints[d.selectedHintIndex];b(l).assign(d.$parent,c),i[0].focus(),d.$emit("AutoCompleteSelect",c),t&&(u=!0)};var w=function(a){d.hints=a,d.hints||(d.hints=[]),d.hints.length>0?d.selectRow(0):g.addClass("noResults"),n&&f(function(){n(k,i)||e(k,i)},0,!1)};m.$parsers.push(function(a){if(j.val(""),a){var e;if(s){var f=d.hints[d.selectedHintIndex];if(d.hints&&d.hints.length>0){var g=f;c(d.displayPath)&&(g=b(d.displayPath)(g)),new RegExp(g,"gi").test(a)&&(e=f)}}else e=a;m.$setValidity("hasSelection",e?!0:!1)}return y(),e}),m.$formatters.push(function(a){if(f(y,0,!0),j.val(""),a){var c;return c=d.displayPath?b(d.displayPath)(a):a}});var x,y=function(){d.selectedHintIndex=null,d.hints=[],g.removeClass("noResults"),f.cancel(x),u?u=!1:(g.addClass("loading"),0===q||a.isString(m.$viewValue)&&q<=m.$viewValue.length?x=f(function(){g.removeClass("loading"),p(m.$viewValue).then(w)},r,!0):g.removeClass("loading"))};i.bind("focus",function(){n&&d.hints&&f(function(){n(k,i)},1,!1)}),i.on("keydown",function(a){d.keyPressEvent(a),d.$apply()})}}}}})}(angular);