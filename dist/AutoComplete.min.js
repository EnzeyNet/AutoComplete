!function(a){var b=a.module("net.enzey.autocomplete",["ngSanitize"]),c=function(b){if(null!==b&void 0!==b){if(a.isNumber(b)&&!isNaN(b))return!0;if(a.isString(b)&&""!==b.trim())return!0}return!1};b.provider("nzAutoCompleteConfig",function(){var b=function(){},c=1,d=250,e=!1,f=!1;this.setPositionHintsFn=function(c){a.isFunction(c)&&(b=c)},this.setMinimumChars=function(a){c=+a},this.setSilentPeriod=function(a){d=+a},this.isSelectionRequired=function(a){e=!!a},this.isNoResultsOnSelect=function(a){f=!!a},this.$get=function(){return{getPositionHintsFn:function(){return b},getMinimumChars:function(){return c},getSilentPeriod:function(){return d},isSelectionRequired:function(){return e},isNoResultsOnSelect:function(){return f}}}});var d="AutoComplete/hintTemplate.html";b.run(["$templateCache",function(a){var b="<div nz-auto-complete-hint-text></div>";a.put(d,b)}]),b.directive("nzAutoCompleteHintText",["$parse",function(a){return{restrict:"AE",link:{post:function(b,c){var d=b.ngModelCtrl.$viewValue,e=null===b.displayPath?"hint":"hint."+b.displayPath,f=new RegExp("("+d+")","gi"),g=a(e)(b);if(g){var h=g.replace(f,"<mark>$1</mark>");c[0].innerHTML=h}}}}}]),b.directive("nzAutoCompleteInclude",["$parse","$compile","$http","$templateCache",function(a,b,c,d){return{restrict:"AE",compile:function(){var e=this.name;return function(f,g,h){var i=a(h[e])(f);c.get(i,{cache:d}).success(function(a){g.replaceWith(b(a)(f))})}}}}]);var e=function(b){b.css("display","block");var c=b.find("div")[0];c.scrollHeight>c.clientHeight?a.element(c).css("overflow-y","scroll"):a.element(c).css("overflow-y",""),b.css("display","")};b.directive("nzAutoComplete",["$parse","$timeout","$compile","nzAutoCompleteConfig",function(b,f,g,h){return{scope:{},restrict:"AE",controller:["$scope",function(a){a.keyPressEvent=function(b){if(null===a.selectedHintIndex||13!==b.keyCode&&9!==b.keyCode){if(40===b.keyCode){if(null!==a.selectedHintIndex&&a.hints.length>1){var c;c=a.selectedHintIndex===a.hints.length-1?0:a.selectedHintIndex+1,a.selectRow(c)}b.preventDefault(),b.stopPropagation()}else if(38===b.keyCode){if(null!==a.selectedHintIndex&&a.hints.length>1){var c;c=0===a.selectedHintIndex?a.hints.length-1:a.selectedHintIndex-1,a.selectRow(c)}b.preventDefault(),b.stopPropagation()}}else a.select(a.selectedHintIndex)}}],compile:function(i,j){i.addClass("autoComplete");var k=i[0].querySelector("input");k=a.element(k?k:'<input type="text"></input>'),i.empty(),k.removeAttr("ng-model"),k.removeAttr("data-ng-model");var l=k.clone();k.addClass("textEntry"),l.addClass("hintBox"),l.attr("tabindex","-1"),l.removeAttr("placeholder");var m=j.ngModel;k.attr("ng-model",m);a.element("<div></div>");return i.append(l),i.append(a.element("<iframe></iframe>")),i.append(k),i.append(a.element('<div class="loadingIndicator"></div>')),{pre:function(a,b,e){a.hints=[];var f=c(e.templateUrl)?e.templateUrl:"'"+d+"'",h=g('							<div class="scrollerContainer">								<iframe></iframe>								<div class="scroller" ng-hide="hints.length < 1">									<div class="hint"											ng-repeat="hint in hints"											ng-click="select($index)"											ng-mouseover="hoverOver($index)"											ng-class="{selectedHint: $index === selectedHintIndex}">										<div nz-auto-complete-include="'+f+'"></div>									</div>								</div>								<div class="scroller noResults">									<span class="noResults hint">{{noResultsText}}</span>								</div>							</div>						')(a);b.append(h),a.displayPath=null,c(e.displayPath)&&(a.displayPath=e.displayPath),a.noResultsText="No Results",c(e.noResultsText)&&(a.noResultsText=e.noResultsText),a.hoverOver=function(b){a.selectRow(b)}},post:function(d,g,i){var j=a.element(g[0].querySelector(".textEntry")),k=a.element(g[0].querySelector(".hintBox")),l=a.element(g[0].querySelector(".scrollerContainer")),n=j.controller("ngModel");d.ngModelCtrl=n;var o=b(i.getResultsFn)(d.$parent);if(!o)throw"A function that returns results is required!";var p=h.getPositionHintsFn();if(c(i.positionHintsFn)){var q=b(i.positionHintsFn)(d.$parent);a.isFunction(q)&&(p=q)}var r=+b(i.minChar)(d.$parent);isNaN(r)&&(r=h.getMinimumChars()),0===r&&o(n.$viewValue).then(x);var s=+b(i.silentPeriod)(d.$parent);isNaN(s)&&(s=h.getSilentPeriod());var t=h.isSelectionRequired();(""===i.selectionRequired||"true"===i.selectionRequired||d.displayPath)&&(t=!0);var u=h.isNoResultsOnSelect();(""===i.noResultsOnSelect||"true"===i.noResultsOnSelect)&&(u=!0);var v=!1,w=function(){var a=d.hints[d.selectedHintIndex];return null!==d.displayPath?b(d.displayPath)(a):a};d.selectRow=function(a){if(a!==d.selectedHintIndex&&a>=0&&a<d.hints.length){var c=g[0].querySelector(".scroller");d.selectedHintIndex=a;var e=!(j[0].scrollWidth>j[0].clientWidth);if(e){var h=w(),i=new RegExp("^"+n.$viewValue,"i"),m=m=b(d.displayPath);if(null!==d.displayPath){var m=m=b(d.displayPath);e=i.test(m(h))}else e=i.test(h)}if(e===!0){var o=j.val();k.val(o+h.slice(o.length,h.length))}else k.val("");f(function(){l.css("display","block");var a=c.querySelector(".selectedHint");a.offsetTop<c.scrollTop?c.scrollTop=a.offsetTop:a.offsetTop+a.clientHeight>c.scrollTop+c.clientHeight&&(c.scrollTop=a.offsetTop+a.clientHeight-c.clientHeight),l.css("display","")},50,!1)}},d.select=function(a){d.selectedHintIndex=a;var c=d.hints[d.selectedHintIndex];b(m).assign(d.$parent,c),j[0].focus(),d.$emit("AutoCompleteSelect",c),u&&(v=!0)};var x=function(a){d.hints=a,d.hints||(d.hints=[]),d.hints.length>0?d.selectRow(0):g.addClass("noResults"),p&&f(function(){p(l,j)||e(l,j)},0,!1)};n.$parsers.push(function(a){if(k.val(""),a){var e;if(t){var f=d.hints[d.selectedHintIndex];if(d.hints&&d.hints.length>0){var g=f;c(d.displayPath)&&(g=b(d.displayPath)(g)),new RegExp(g,"gi").test(a)&&(e=f)}}else e=a;n.$setValidity("hasSelection",e?!0:!1)}return z(),e}),n.$formatters.push(function(a){if(f(z,0,!0),k.val(""),a){var c;return c=d.displayPath?b(d.displayPath)(a):a}});var y,z=function(){d.selectedHintIndex=null,d.hints=[],g.removeClass("noResults"),f.cancel(y),v?v=!1:(g.addClass("loading"),0===r||a.isString(n.$viewValue)&&r<=n.$viewValue.length?y=f(function(){g.removeClass("loading"),o(n.$viewValue).then(x)},s,!0):g.removeClass("loading"))};j.bind("focus",function(){p&&d.hints&&f(function(){p(l,j)},1,!1)}),j.on("keydown",function(a){d.keyPressEvent(a),d.$apply()})}}}}}])}(angular);